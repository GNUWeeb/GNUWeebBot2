# SPDX-License-Identifier: GPL-2.0-only

DEP_DIRS += $(BASE_DEP_DIR)/modules

OBJ_CC += \
	$(BASE_DIR)/modules/module.o

GW_MODULE_LIST :=
include $(BASE_DIR)/modules/ping/Makefile

$(BASE_DIR)/modules/module.o: $(BASE_DIR)/modules/module_list.h
$(BASE_DIR)/modules/module.o: $(BASE_DIR)/modules/module_table.h

$(BASE_DIR)/modules/module_list.h:
	$(S)echo "   GEN		" "$(@:$(BASE_DIR)/%=%)";
	@echo "/* This file is automatically generated. Do not edit. */" > $@;
	@for module in $(GW_MODULE_LIST); do \
		echo "#include \"$$module/mod_info.h\"" >> $@; \
	done;

$(BASE_DIR)/modules/module_table.h: $(BASE_DIR)/modules/module_list.h
	$(S)echo "   GEN		" "$(@:$(BASE_DIR)/%=%)";
	@echo "/* This file is automatically generated. Do not edit. */" > $@;
	@for module in $(GW_MODULE_LIST); do \
		echo "	&gw_mod_info_$$module," >> $@; \
	done;

clean_module_list:
	@rm -vf $(BASE_DIR)/modules/module_list.h \
		$(BASE_DIR)/modules/module_table.h

clean: clean_module_list

.PHONY: clean_module_list
